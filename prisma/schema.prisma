 generator client {
  provider = "prisma-client-js"
 }

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RawNews {
  id            String         @id @default(uuid()) @db.Uuid
  source        String
  title         String
  url           String?
  content       String         @db.Text
  publishedAt   DateTime?
  collectedAt   DateTime       @default(now())
  language      String?
  symbolsRaw    String[]       @db.Text
  ingestStatus  String         @default("ingested")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  analyses      NewsAnalysis[]
  signals       Signal[]
  alerts        Alert[]
}

model NewsAnalysis {
  id                     String    @id @default(uuid()) @db.Uuid
  rawNewsId              String    @unique @db.Uuid
  assets                 Json?
  eventType              String?
  sentiment              String?
  isRumor                Boolean?
  isConfirmedByOfficial  Boolean?
  timeRelevance          String?
  priceDirectionHint     String?
  keyReasons             String[]
  rawConfidence          Float?
  extra                  Json?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  rawNews                RawNews   @relation(fields: [rawNewsId], references: [id])
  signals                Signal[]
  alerts                 Alert[]
}

model Signal {
  id             String   @id @default(uuid()) @db.Uuid
  rawNewsId      String   @db.Uuid
  newsAnalysisId String?  @db.Uuid
  impactScore    Float
  scoreBreakdown Json?
  thresholdUsed  Float?
  weightsUsed    Json?
  status         String   @default("no_alert")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  rawNews        RawNews       @relation(fields: [rawNewsId], references: [id])
  analysis       NewsAnalysis? @relation(fields: [newsAnalysisId], references: [id])
  alerts         Alert[]
}

model Alert {
  id             String   @id @default(uuid()) @db.Uuid
  signalId       String   @db.Uuid
  rawNewsId      String   @db.Uuid
  newsAnalysisId String?  @db.Uuid
  impactScore    Float
  severity       String
  summary        String   @db.Text
  status         String   @default("pending")
  disclaimer     String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  signal         Signal       @relation(fields: [signalId], references: [id])
  rawNews        RawNews      @relation(fields: [rawNewsId], references: [id])
  analysis       NewsAnalysis? @relation(fields: [newsAnalysisId], references: [id])
}

model SignalConfig {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique
  description String?  @db.Text
  weights     Json
  thresholds  Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model MarketSnapshot {
  id               String   @id @default(uuid()) @db.Uuid
  symbol           String
  assetType        String?
  priceNow         Decimal  @db.Decimal(18, 6)
  ret5m            Decimal? @db.Decimal(10, 4)
  ret1h            Decimal? @db.Decimal(10, 4)
  volumeRatio1h    Decimal? @db.Decimal(10, 4)
  volatilityRatio1h Decimal? @db.Decimal(10, 4)
  collectedAt      DateTime @default(now())
  metadata         Json?
}
